# Требования к сервису пользовательской активности и аналитики

## Функциональные требования

1. Реализовать систему рейтинга фильмов с лайками
2. Добавить функцию пользовательских отзывов к фильмам
3. Создать функцию истории просмотров пользователя
4. Реализовать закладки/избранное для фильмов
5. Обеспечить отслеживание списка "непросмотренных" или "частично просмотренных" фильмов
6. Отслеживать данные о взаимодействии с плеером (например, переключение языков)
7. Предоставить инструменты для аналитики пользовательского поведения
8. Реализовать систему аутентификации пользователей
9. Обеспечить соотнесение каждого запроса с конкретным пользователем

## Нефункциональные требования

1. **Производительность и масштабируемость**:
   - **RPS**: Система должна обрабатывать не менее 1000 запросов в секунду 
   - **Латентность**: Время отклика API не должно превышать 200 мс для 95% запросов
   - **Соотношение запросов и событий**: В среднем один пользовательский запрос может генерировать до 5 событий для записи в аналитическую систему

2. **Доступность и надежность**:
   - **Доступность**: Сервис должен быть доступен 99.9% времени (допустимый простой не более 43 минут в месяц)
   - **Устойчивость к сбоям**: Система должна корректно обрабатывать временные сбои в работе компонентов
   - **Восстановление**: Время восстановления после сбоя не должно превышать 5 минут

3. **Аналитика и обработка данных**:
   - **Формат данных**: Данные должны быть структурированы в формате, удобном для аналитических инструментов (JSON)
   - **Полнота данных**: Система должна обеспечивать сбор всех типов пользовательских событий, включая:
     - Существующие события (поиск по фильмам, применение фильтров, авторизация)
     - Новые события согласно требованиям (оценки, отзывы, просмотры, закладки и др.)
   - **Консистентность**: Каждое событие должно быть однозначно привязано к пользователю, объекту взаимодействия (фильм, элемент интерфейса) и временной метке

4. **Безопасность и идентификация**:
   - **Аутентификация**: Все запросы должны проходить аутентификацию
   - **Авторизация**: Система должна ограничивать доступ к данным на основе ролей пользователей
   - **Идентификация**: Каждый запрос должен содержать уникальный идентификатор пользователя

5. **Архитектурные требования**:
   - **Модульность**: Компоненты системы должны быть слабо связаны для возможности независимого масштабирования
   - **Балансировка нагрузки**: Равномерное распределение запросов между инстансами сервисов
   - **Кэширование**: Применение кэширования для уменьшения нагрузки на базу данных
   - **Оптимизация взаимодействия**: Минимизация сетевых взаимодействий между AsyncAPI и сервисом BigData

## Метрики для планирования оборудования

Для расчета необходимого оборудования на 1-2 года используются следующие параметры:

- **RPS**: 1000 запросов в секунду на уровне Nginx с планируемым ростом до 2000 RPS через год
- **DAU (Ежедневные активные пользователи)**: 500,000 (требует уточнения)
- **MAU (Ежемесячные активные пользователи)**: 2,000,000 (требует уточнения)
- **Средний размер сообщения**: 2 КБ для событий пользовательской активности (требует уточнения)
- **Объем генерируемых данных**: Приблизительно 8.64 ГБ в день при текущих показателях
- **Период хранения данных**: Необходимо хранить данные не менее 2 лет для анализа долгосрочных трендов
- **Ожидаемый темп роста**: 15% ежеквартально (требует уточнения)

Эти метрики следует определить для точного расчета потребностей в хранилище на 1-2 года и соответствующей мощности серверов.